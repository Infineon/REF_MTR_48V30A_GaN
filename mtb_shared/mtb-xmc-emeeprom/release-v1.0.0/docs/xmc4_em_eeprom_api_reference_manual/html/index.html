<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XMC4000 Emulated EEPROM Middleware Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XMC4000 Emulated EEPROM Middleware Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Em_EEPROM Middleware Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Emulated EEPROM (Em_EEPROM) middleware emulates an EEPROM storage in XMC4xxxx internal flash memory. The Em_EEPROM middleware operates on the top of the flash driver included in the XMCLib CAT3 Peripheral Driver Library.</p>
<p>Use the Em_EEPROM to store non-volatile data on a target device when increasing flash memory endurance is important.</p>
<p>Please note the Internal Flash is reserved by EEPROM middleware when using this asset and update the Linker script appropriately is required.</p>
<p><b>Features:</b></p><ul>
<li>EEPROM-Like Non-Volatile Storage</li>
<li>Easy to use Read and Write</li>
</ul>
<h1><a class="anchor" id="section_em_eeprom_general_description"></a>
General Description</h1>
<p>The XMC4000 emulated EEPROM support is provided with the APIs described below.</p>
<p>It should be noted that the non-volatile memory required to store the EEPROM Data is mapped to Internal Flash. In the XMC 4xxx emulated EEPROM Middleware the Flash region required for EEPROM Middleware is 64 KBytes of flash and is reserved from offset of 0x10000 from the Base of Flash. This is FIXED and cannot be changed. When adding this Middleware asset to a application, users are required to update/modify the application linker script to exclude this flash region from the memory used for application code/initialized data. So the FIRST 64 KBytes of Flash and flash beyond 128 KBytes of Flash can be used for code and initialized data in application. Examples of how to modify the Linker script create the memory hole of 64 KBytes starting at 64 KBytes from start of flash is provided in this documentation.</p>
<h1><a class="anchor" id="section_em_eeprom_linker_script_update"></a>
Linker Script Updates</h1>
<p>It should be noted that the non-volatile memory required to store the EEPROM Data is mapped to Internal Flash. In the XMC 4xxx emulated EEPROM Middleware the 64 KBytes of Flash region required for EEPROM is allocated from 0x10000 from start of Flash till 0x20000 from start of Flash. The amount of Flash space reserved (64 KBytes) is fixed and its location CANNOT be changed. It is advisable for user(s) of emulated EEPROM to update their Linker file (script) to Not use the Flash space reserved for EEPROM for code/initialized data of application. A properly updated Linker script will remove the Flash region reserved for EEPROM from being used by linker for code or initialized data.</p>
<p>For the Kit/XMC device you are using, please select the proper Linker script. For Infineon ModusToolbox targets, the GCC_ARM and ARM linker scripts are present in target for the kit under TOOLCHAIN_GCC_ARM and TOOLCHAIN_ARM. For IAR, please make a copy of the IAR linker script from the IAR toolchain and edit it for the Project using XMC4xxx Emulated EEPROM. Note - the ModusToolBox allows use of custom Linker script by editing in Makefile the tag LINKER_SCRIPT=&lt;path to custom linker script&gt;.</p>
<p>Examples of how the linker scripts be modified is provided below.</p>
<p>Note: EEPROM Middleware reserves 64 KBytes of Flash from offset 0x10000 to 0x20000 from start of Flash memory. So a memory region hole has to be created in Linker script memory map, so that memory will Not be used by linker for code or initialized data..</p>
<p>Note: The Vector table has to be mapped at start of Flash memory as the Reset Vector is the first entry in the Vector table.</p>
<p>The above two constraints can be seen in examples of modified linker scripts below.</p>
<p>Example of GCC_ARM Linker script for XMC4200x256 Kit/Device (XMC4200x256.ld):</p>
<p>Original Linker script Memory map and sections:</p>
<div class="fragment"><div class="line">MEMORY</div><div class="line">{</div><div class="line">        FLASH_1_cached(RX) : ORIGIN = 0x08000000, LENGTH = 0x40000</div><div class="line">        FLASH_1_uncached(RX) : ORIGIN = 0x0C000000, LENGTH = 0x40000</div><div class="line">        PSRAM_1(!RX) : ORIGIN = 0x1FFFC000, LENGTH = 0x4000</div><div class="line">        DSRAM_1_system(!RX) : ORIGIN = 0x20000000, LENGTH = 0x6000</div><div class="line">        SRAM_combined(!RX) : ORIGIN = 0x1FFFC000, LENGTH = 0xA000</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">SECTIONS</div><div class="line">{</div><div class="line"></div><div class="line">  .text :</div><div class="line"> {</div><div class="line">   sText = .;</div><div class="line">   KEEP(*(.reset));</div><div class="line">   *(.text .text.* .gnu.linkonce.t.*);</div><div class="line"></div><div class="line">   KEEP(*(.init))</div><div class="line">   KEEP(*(.fini))</div><div class="line"></div><div class="line"></div><div class="line">   *crtbegin.o(.ctors)</div><div class="line">   *crtbegin?.o(.ctors)</div><div class="line">   *(EXCLUDE_FILE(*crtend?.o *crtend.o) .ctors)</div><div class="line">   *(SORT(.ctors.*))</div><div class="line">   *(.ctors)</div><div class="line"></div><div class="line"></div><div class="line">   *crtbegin.o(.dtors)</div><div class="line">   *crtbegin?.o(.dtors)</div><div class="line">   *(EXCLUDE_FILE(*crtend?.o *crtend.o) .dtors)</div><div class="line">   *(SORT(.dtors.*))</div><div class="line">   *(.dtors)</div><div class="line"></div><div class="line">   *(.rodata .rodata.*)</div><div class="line">   *(.gnu.linkonce.r*)</div><div class="line"></div><div class="line">   *(vtable)</div><div class="line"></div><div class="line">   . = ALIGN(4);</div><div class="line"> } &gt; FLASH_0_cached AT &gt; FLASH_0_uncached</div></div><!-- fragment --><p>Modified Linker script Memory map and sections:</p>
<div class="fragment"><div class="line">MEMORY</div><div class="line">{</div><div class="line">        FLASH_0_cached(RX) : ORIGIN = 0x08000000, LENGTH = 0x10000</div><div class="line">        FLASH_1_uncached(RX) : ORIGIN = 0x0C000000, LENGTH = 0x10000</div><div class="line">        FLASH_1_cached(RX) : ORIGIN = 0x08020000, LENGTH = 0x20000</div><div class="line">        FLASH_1_uncached(RX) : ORIGIN = 0x0C020000, LENGTH = 0x20000</div><div class="line">        PSRAM_1(!RX) : ORIGIN = 0x1FFFC000, LENGTH = 0x4000</div><div class="line">        DSRAM_1_system(!RX) : ORIGIN = 0x20000000, LENGTH = 0x6000</div><div class="line">        SRAM_combined(!RX) : ORIGIN = 0x1FFFC000, LENGTH = 0xA000</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">SECTIONS</div><div class="line">{</div><div class="line"></div><div class="line"></div><div class="line">  .reset :</div><div class="line">  {</div><div class="line">    KEEP(*(.reset));</div><div class="line">  } &gt; FLASH_0_cached AT &gt; FLASH_0_uncached</div><div class="line"></div><div class="line">  .text :</div><div class="line">  {</div><div class="line">    sText = .;</div><div class="line">    *(.text .text.* .gnu.linkonce.t.*);</div><div class="line"></div><div class="line"></div><div class="line">    KEEP(*(.init))</div><div class="line">    KEEP(*(.fini))</div><div class="line"></div><div class="line"></div><div class="line">    *crtbegin.o(.ctors)</div><div class="line">    *crtbegin?.o(.ctors)</div><div class="line">    *(EXCLUDE_FILE(*crtend?.o *crtend.o) .ctors)</div><div class="line">    *(SORT(.ctors.*))</div><div class="line">    *(.ctors)</div><div class="line"></div><div class="line"></div><div class="line">    *crtbegin.o(.dtors)</div><div class="line">    *crtbegin?.o(.dtors)</div><div class="line">    *(EXCLUDE_FILE(*crtend?.o *crtend.o) .dtors)</div><div class="line">    *(SORT(.dtors.*))</div><div class="line">    *(.dtors)</div><div class="line"></div><div class="line">    *(.rodata .rodata.*)</div><div class="line">    *(.gnu.linkonce.r*)</div><div class="line"></div><div class="line">    *(vtable)</div><div class="line"></div><div class="line">    . = ALIGN(4);</div><div class="line">  } &gt; FLASH_1_cached AT &gt; FLASH_1_uncached</div></div><!-- fragment --><p>Note: There is Gap in memory map for offset 0x10000 (64 KBytes into Flash) and for length: 0x10000 (64 KBytes).</p>
<p>Example of ARM Linker script for XMC4200x256 Kit/Device (XMC4200x256.sct):</p>
<p>Original Linker script Memory map and load:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __ROM_BASE     0x08000000</span></div><div class="line"><span class="preprocessor">#define __ROM_SIZE     0x00040000</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#define __RO_BASE         __ROM_BASE</span></div><div class="line"><span class="preprocessor">#define __RO_SIZE         __ROM_SIZE</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define __NO_INIT         64</span></div><div class="line"></div><div class="line">LR_ROM __RO_BASE __RO_SIZE  {                       ; load region size_region</div><div class="line">  ER_ROM __RO_BASE __RO_SIZE  {                     ; load address = execution address</div><div class="line">   *.o (RESET, +First)</div><div class="line">   *(InRoot$$Sections)</div><div class="line">   .ANY (+RO)</div><div class="line">   .ANY (+XO)</div><div class="line">  }</div></div><!-- fragment --><p>Modified Linker script Memory map and load:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __ROM_BASE     0x08000000</span></div><div class="line"><span class="preprocessor">#define __ROM_SIZE     0x00010000</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define __ROM1_BASE     0x08020000</span></div><div class="line"><span class="preprocessor">#define __ROM1_SIZE     0x00020000</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#define __RO_BASE         __ROM_BASE</span></div><div class="line"><span class="preprocessor">#define __RO_SIZE         __ROM_SIZE</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define __R1_BASE         __ROM1_BASE</span></div><div class="line"><span class="preprocessor">#define __R1_SIZE         __ROM1_SIZE</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define __NO_INIT         64</span></div><div class="line"></div><div class="line">LR_ROM __RO_BASE __RO_SIZE  {                       ; load region size_region</div><div class="line">  ER_ROM __RO_BASE __RO_SIZE  {                     ; load address = execution address</div><div class="line">   *.o (RESET, +First)</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line">LR_ROM_1 __R1_BASE __R1_SIZE  {                       ; load region size_region</div><div class="line">  ER_ROM_1 __R1_BASE __R1_SIZE  {                     ; load address = execution address</div><div class="line">   *(InRoot$$Sections)</div><div class="line">   .ANY (+RO)</div><div class="line">   .ANY (+XO)</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Example of IAR Linker script for XMC4200x256 Kit/Device (XMC4200xxxx256.icf):</p>
<p>Original Linker script Memory map:</p>
<div class="fragment"><div class="line">define symbol __ICFEDIT_region_ROM_start__ = 0x08000000;</div><div class="line">define symbol __ICFEDIT_region_ROM_end__   = 0x0803FFFF;</div><div class="line"></div><div class="line"></div><div class="line">define region ROM_region   = mem:[from __ICFEDIT_region_ROM_start__ to __ICFEDIT_region_ROM_end__];</div><div class="line"></div><div class="line">place at address mem:__ICFEDIT_intvec_start__ {readonly section .intvec};</div><div class="line"></div><div class="line">place in ROM_region  {readonly};</div></div><!-- fragment --><p>Modified Linker script Memory map:</p>
<div class="fragment"><div class="line">define symbol __ICFEDIT_region_ROM_start__ = 0x08000000;</div><div class="line">define symbol __ICFEDIT_region_ROM_end__   = 0x08010000;</div><div class="line">define symbol __ICFEDIT_region_ROM_1_start__ = 0x08020000;</div><div class="line">define symbol __ICFEDIT_region_ROM_1_end__   = 0x0803FFFF;</div><div class="line"></div><div class="line"></div><div class="line">define region ROM_region   = mem:[from __ICFEDIT_region_ROM_start__ to __ICFEDIT_region_ROM_end__];</div><div class="line">define region ROM_1_region   = mem:[from __ICFEDIT_region_ROM_1_start__ to __ICFEDIT_region_ROM_1_end__];</div><div class="line"></div><div class="line">place at address mem:__ICFEDIT_intvec_start__ {readonly section .intvec};</div><div class="line"></div><div class="line">place in ROM_region  {readonly <span class="keywordtype">object</span> main.o};</div><div class="line">place in ROM_1_region  {readonly};</div></div><!-- fragment --><p>Example of GCC_ARM Linker script for XMC4100x128 Kit/Device:</p>
<p>Note: Since this device has Only 128 KBytes of Flash, if EEPROM is used on this device, the only available Flash for Code and Initialized data will be the first 64 KBytes, as the 2nd 64 KBytes of Flash will be reserved for EEPROM. So the modification to the linker script is to map only the first 64 KBytes for code and initialized data. The modification to linker script will be similar to changes shown in detail for XMC 1xxx EEPROM. Below is the example of change for GCC_ARM Linker script.</p>
<p>Original Linker script Memory map and sections (XMC4100x128.ld):</p>
<div class="fragment"><div class="line">MEMORY</div><div class="line">{</div><div class="line">        FLASH_1_cached(RX) : ORIGIN = 0x08000000, LENGTH = 0x20000</div><div class="line">        FLASH_1_uncached(RX) : ORIGIN = 0x0C000000, LENGTH = 0x20000</div><div class="line">        PSRAM_1(!RX) : ORIGIN = 0x1FFFE000, LENGTH = 0x2000</div><div class="line">        DSRAM_1_system(!RX) : ORIGIN = 0x20000000, LENGTH = 0x3000</div><div class="line">        SRAM_combined(!RX) : ORIGIN = 0x1FFFE000, LENGTH = 0x5000</div><div class="line">}</div></div><!-- fragment --><p>Modified Linker script Memory map and sections:</p>
<div class="fragment"><div class="line">MEMORY</div><div class="line">{</div><div class="line">        FLASH_1_cached(RX) : ORIGIN = 0x08000000, LENGTH = 0x10000</div><div class="line">        FLASH_1_uncached(RX) : ORIGIN = 0x0C000000, LENGTH = 0x10000</div><div class="line">        PSRAM_1(!RX) : ORIGIN = 0x1FFFE000, LENGTH = 0x2000</div><div class="line">        DSRAM_1_system(!RX) : ORIGIN = 0x20000000, LENGTH = 0x3000</div><div class="line">        SRAM_combined(!RX) : ORIGIN = 0x1FFFE000, LENGTH = 0x5000</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="section_em_eeprom_app_usage"></a>
Application Configuration and API Usage</h1>
<p>The XMC4 Emulated EEPROM asset can used to store non-volatile data in Flash with improved resiliency. In XMC4 emulated eeprom asset the Flash used for mapping the user data to flash is fixed and cannot be changed. It is mapped from offset of 64 KBytes (0x10000) for length of 64 KBytes. Before using emulated EEPROM asset, the Flash in the region Device Flash Base + 0x10000 to Device Flash Base + 0x20000 should be erased and have No data present in it. Since EEPROM retains data between subsequent power-cycles/reboots and re-programming of application. This region should not be erased unless it is explicitly desired to get rid of previously stored data.</p>
<p>The XMC4 EEPROM configuration data is just the "len" of EEPROM which is passed to the initialization API.</p>
<p>The typical application programming sequence for using the eeprom asset is to initially call the API:</p>
<p>E_EEPROM_XMC4_STATUS_t <a class="el" href="group__E__EEPROM__XMC4__functions.html#gaac994c286ca557e823dda20eb2c79641" title="Initializes flash emulated EEPROM to start read and write operations. ">E_EEPROM_XMC4_Init(E_EEPROM_XMC4_t *const handle, uint32_t len)</a>;</p>
<p>Passing in the "E_EEPROM_XMC4_t *const handle" data structure which has only a Boolean variable. This is typically "false" when passed to this Initialization function.</p>
<p>After that the XMC4 provided APIs for Read/Write APIs (Byte or Array APIs) can be called. When it is desired to store the updated data to Flash (non-volatile), the API: <a class="el" href="group__E__EEPROM__XMC4__functions.html#ga8cbd3811c988d87bf8a4a6b739597b32" title="Programs the flash with the latest data block available in RAM. ">E_EEPROM_XMC4_UpdateFlashContents()</a> should be called. It should be noted that any Writes between 2 calls to <a class="el" href="group__E__EEPROM__XMC4__functions.html#ga8cbd3811c988d87bf8a4a6b739597b32" title="Programs the flash with the latest data block available in RAM. ">E_EEPROM_XMC4_UpdateFlashContents()</a> is only stored in RAM and not written to flash (non-volatile). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>XMC4000 Emulated EEPROM Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
